---
alwaysApply: true
---
# ğŸ›£ï¸ Roadmap â€” SiteFlow SaaS (Reboot)

> Lá»™ trÃ¬nh chi tiáº¿t Ä‘á»ƒ Cursor AI (lá»£n ğŸ·) thá»±c thi tá»«ng phase, **bÃ¡m sÃ¡t Project_Description.md**.  
> Má»—i phase cÃ³: Má»¥c tiÃªu â†’ CÃ´ng viá»‡c â†’ Lá»‡nh thá»±c thi â†’ Kiá»ƒm tra/Acceptance â†’ BÃ¡o cÃ¡o.

---

## ğŸ”° Phase 0 â€” Setup & Foundation
**Má»¥c tiÃªu:** MÃ´i trÆ°á»ng dev á»•n Ä‘á»‹nh, CI/CD cÆ¡ báº£n, boilerplate cháº¡y OK.

**CÃ´ng viá»‡c:**
- Clone repo tá»« GitHub.
- CÃ i Ä‘áº·t dependencies.
- Thiáº¿t láº­p `.env.local` vá»›i `DATABASE_URL`, `CLERK_SECRET_KEY`.
- Cáº¥u hÃ¬nh GitHub Actions cho lint, typecheck, test, e2e.
- Báº­t branch protection + PR template + CODEOWNERS.

**Lá»‡nh thá»±c thi:**
```bash
pnpm install
pnpm dev
```

**Kiá»ƒm tra/Acceptance âœ…:**
- `pnpm dev` cháº¡y OK, localhost hiá»ƒn thá»‹.
- Clerk login hiá»ƒn thá»‹ trang login.
- CI workflow cháº¡y qua Pull Request.

**BÃ¡o cÃ¡o:** Commit + push branch `phase-0-setup`.

---

## ğŸ§± Phase 1 â€” Database Schema & Migration
**Má»¥c tiÃªu:** Schema domain chuáº©n vá»›i 8 báº£ng, migration-first.

**CÃ´ng viá»‡c:**
- Viáº¿t `src/models/Schema.ts`.
- Táº¡o 8 báº£ng: projects, categories, tasks, daily_logs, daily_log_tasks, media_assets, transactions, share_links.
- RÃ ng buá»™c: tasks.categoryId â†’ categories.id; daily_logs.categoryId; daily_log_tasks.dailyLogId + taskId.
- Enum Postgres: project_status, task_status, log_task_status, media_kind, transaction_type.
- Audit fields, soft delete, orgId.
- Viáº¿t seed script `src/scripts/seed.ts`.

**Lá»‡nh thá»±c thi:**
```bash
pnpm db:generate
pnpm db:migrate
pnpm tsx src/scripts/seed.ts
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Migration cháº¡y OK.
- Seed script in ra `Seed OK`.
- `psql \dt` Ä‘á»§ 8 báº£ng.

**BÃ¡o cÃ¡o:** Commit branch `phase-1-schema`.

---

## ğŸ” Phase 2 â€” RBAC & Security
**Má»¥c tiÃªu:** Multi-tenant isolation + role-based access.

**CÃ´ng viá»‡c:**
- TÃ­ch há»£p Clerk Orgs + Roles (`ADMIN, PM, ENGINEER, ACCOUNTANT`).
- Viáº¿t `roles.ts`, `context.ts`, `withRole.ts`.
- Báº­t RLS cho 8 báº£ng: `org_id = current_setting('app.current_org')::uuid`.
- Migration file: `xxxx_enable_rls.sql`.
- ThÃªm HTTP headers: CSP, HSTS, Referrer-Policy, Permissions-Policy.
- Endpoint demo: `/api/v1/_rbac-check`.

**Lá»‡nh thá»±c thi:**
```bash
pnpm db:migrate
pnpm dev
```

**Kiá»ƒm tra/Acceptance âœ…:**
- SQL test: SELECT sai org â†’ FAIL.
- API `/api/v1/_rbac-check` tráº£ 403 náº¿u sai role, 200 náº¿u Ä‘Ãºng.
- Browser response Ä‘á»§ headers.

**BÃ¡o cÃ¡o:** Commit branch `phase-2-rbac`.

---

## ğŸ”Œ Phase 3 â€” API v1
**Má»¥c tiÃªu:** CRUD chuáº©n REST, validation.

**CÃ´ng viá»‡c:**
- Táº¡o route handlers:
  - `/api/v1/projects`
  - `/api/v1/categories`
  - `/api/v1/tasks`
  - `/api/v1/daily-logs`
  - `/api/v1/daily-log-tasks`
  - `/api/v1/transactions`
  - `/api/v1/share-links`
  - `/api/v1/cloudinary/sign`
- Validation: Zod.
- Error: RFC7807 format.
- Cursor-based pagination.
- Soft delete filter.
- OpenAPI spec.

**Lá»‡nh thá»±c thi:**
```bash
pnpm dev
pnpm test
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Postman CRUD cháº¡y OK.
- Error JSON theo RFC7807.
- Pagination hoáº¡t Ä‘á»™ng.
- KhÃ´ng tráº£ record soft deleted.

**BÃ¡o cÃ¡o:** Commit branch `phase-3-api`.

---

## ğŸ“Š Phase 4 â€” Progress Service
**Má»¥c tiÃªu:** TÃ­nh tiáº¿n Ä‘á»™ realtime.

**CÃ´ng viá»‡c:**
- Postgres views: `category_progress`, `project_progress`.
- Service: `getCategoryProgress`, `getProjectProgress`.
- API: `/api/v1/categories/:id/progress`, `/api/v1/projects/:id/progress`.
- Unit + integration test.

**Lá»‡nh thá»±c thi:**
```bash
pnpm db:migrate
pnpm test
```

**Kiá»ƒm tra/Acceptance âœ…:**
- CÃ´ng thá»©c Ä‘Ãºng.
- Status láº¥y tá»« daily_log_tasks (fallback tasks.status).
- Project progress = weighted average.

**BÃ¡o cÃ¡o:** Commit branch `phase-4-progress`.

---

## ğŸ–¼ï¸ Phase 5 â€” Media & Upload
**Má»¥c tiÃªu:** Quáº£n lÃ½ media assets.

**CÃ´ng viá»‡c:**
- API `/api/v1/cloudinary/sign`, `/api/v1/media-assets`.
- Component FE: `UploadButton.tsx`.
- LiÃªn káº¿t media vá»›i DailyLog.

**Lá»‡nh thá»±c thi:**
```bash
pnpm dev
pnpm test
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Upload Cloudinary OK.
- Metadata lÆ°u DB.
- UI preview hiá»ƒn thá»‹.

**BÃ¡o cÃ¡o:** Commit branch `phase-5-media`.

---

## ğŸ‘©â€ğŸ¨ Phase 6 â€” UI
**Má»¥c tiÃªu:** Giao diá»‡n Ä‘áº§y Ä‘á»§, canonical routes.

**CÃ´ng viá»‡c:**
- Dashboard: KPI cards, project list, filters, modals.
- Project Detail: tabs Overview, Tasks, Daily Logs, Finance, Share Links.
- Public Share Page `/share/[token]`.
- Sidebar canonical (khÃ´ng `/dashboard/projects`).
- A11y test báº±ng axe-core.

**Lá»‡nh thá»±c thi:**
```bash
pnpm dev
pnpm test:e2e
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Tabs Ä‘iá»u hÆ°á»›ng Ä‘Ãºng.
- Console sáº¡ch.
- Finance cáº£nh bÃ¡o over-budget.
- Share link public hiá»ƒn thá»‹.

**BÃ¡o cÃ¡o:** Commit branch `phase-6-ui`.

---

## ğŸ§ª Phase 7 â€” Testing & CI
**Má»¥c tiÃªu:** Äáº£m báº£o cháº¥t lÆ°á»£ng tá»± Ä‘á»™ng.

**CÃ´ng viá»‡c:**
- Unit test: schema, RBAC, progress.
- Integration test: API CRUD, progress, upload.
- E2E test: Dashboard â†’ Project â†’ Share.
- Accessibility test (axe-core).
- Perf test (k6).
- CI pipeline auto run.

**Lá»‡nh thá»±c thi:**
```bash
pnpm test
pnpm test:e2e
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Unit, integration, e2e Ä‘á»u pass.
- CI xanh.

**BÃ¡o cÃ¡o:** Commit branch `phase-7-testing`.

---

## ğŸš€ Phase 8 â€” Deploy & Monitoring
**Má»¥c tiÃªu:** Production stable, cÃ³ giÃ¡m sÃ¡t.

**CÃ´ng viá»‡c:**
- FE deploy Vercel, DB deploy Render/Neon.
- Monitoring: Sentry + Grafana/DataDog.
- Alerts: Slack/email.
- Backup cross-region.

**Lá»‡nh thá»±c thi:**
```bash
pnpm build
pnpm start
```

**Kiá»ƒm tra/Acceptance âœ…:**
- Prod cháº¡y OK.
- Error log vá» Sentry.
- Restore DB backup OK.

**BÃ¡o cÃ¡o:** Commit branch `phase-8-deploy`.
