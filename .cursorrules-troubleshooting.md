# Troubleshooting Guide

## Common Development Issues

### Database Connection Issues
**Problem**: Database connection fails or times out
**Symptoms**: 
- Error: "Database connection failed"
- Error: "Connection timeout"
- Error: "Invalid database URL"

**Solutions**:
1. **Check Environment Variables**:
   ```bash
   # Verify DATABASE_URL is set correctly
   echo $DATABASE_URL
   
   # For local development with PGlite
   DATABASE_URL="file:./local.db"
   
   # For production with PostgreSQL
   DATABASE_URL="postgresql://user:password@localhost:5432/dbname"
   ```

2. **Test Database Connection**:
   ```bash
   # Test connection with Drizzle Studio
   npm run db:studio
   
   # Check database status
   npm run db:status
   ```

3. **Reset Database**:
   ```bash
   # Reset local database
   rm -f local.db
   npm run db:migrate
   ```

### Authentication Issues
**Problem**: Clerk authentication not working
**Symptoms**:
- Error: "Clerk key not found"
- Error: "Authentication failed"
- Users can't sign in/up

**Solutions**:
1. **Verify Clerk Configuration**:
   ```bash
   # Check environment variables
   echo $NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
   echo $CLERK_SECRET_KEY
   ```

2. **Update Clerk Keys**:
   ```typescript
   // src/middleware.ts
   import { clerkMiddleware } from '@clerk/nextjs';
   
   export default clerkMiddleware({
     publishableKey: process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY,
     secretKey: process.env.CLERK_SECRET_KEY,
   });
   ```

3. **Check Clerk Dashboard**:
   - Verify domain configuration
   - Check allowed origins
   - Ensure webhooks are configured

### Build and Compilation Issues
**Problem**: TypeScript compilation errors
**Symptoms**:
- Error: "Type 'X' is not assignable to type 'Y'"
- Error: "Property 'X' does not exist on type 'Y'"
- Build fails with type errors

**Solutions**:
1. **Check TypeScript Configuration**:
   ```json
   // tsconfig.json
   {
     "compilerOptions": {
       "strict": true,
       "noUncheckedIndexedAccess": true,
       "baseUrl": ".",
       "paths": {
         "@/*": ["./src/*"]
       }
     }
   }
   ```

2. **Fix Type Errors**:
   ```bash
   # Check for type errors
   npm run check-types
   
   # Fix with auto-fix
   npm run lint:fix
   ```

3. **Update Dependencies**:
   ```bash
   # Update TypeScript and related packages
   npm update typescript @types/react @types/node
   ```

### Styling Issues
**Problem**: Tailwind CSS classes not working
**Symptoms**:
- Styles not applied
- Classes not recognized
- Build errors with CSS

**Solutions**:
1. **Check Tailwind Configuration**:
   ```javascript
   // tailwind.config.ts
   module.exports = {
     content: [
       './src/**/*.{js,ts,jsx,tsx,mdx}',
       './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
       './src/components/**/*.{js,ts,jsx,tsx,mdx}',
     ],
     theme: {
       extend: {},
     },
     plugins: [],
   }
   ```

2. **Verify CSS Import**:
   ```typescript
   // src/app/globals.css
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   ```

3. **Check PostCSS Configuration**:
   ```javascript
   // postcss.config.js
   module.exports = {
     plugins: {
       tailwindcss: {},
       autoprefixer: {},
     },
   }
   ```

### Import and Path Issues
**Problem**: Module resolution errors
**Symptoms**:
- Error: "Module not found"
- Error: "Cannot resolve module"
- Import paths not working

**Solutions**:
1. **Check Path Aliases**:
   ```json
   // tsconfig.json
   {
     "compilerOptions": {
       "baseUrl": ".",
       "paths": {
         "@/*": ["./src/*"],
         "@/components/*": ["./src/components/*"],
         "@/lib/*": ["./src/lib/*"]
       }
     }
   }
   ```

2. **Verify File Extensions**:
   ```typescript
   // Use explicit extensions when needed
   import { Button } from '@/components/ui/button.tsx';
   import { utils } from '@/lib/utils.ts';
   ```

3. **Check Node Modules**:
   ```bash
   # Clear node_modules and reinstall
   rm -rf node_modules package-lock.json
   npm install
   ```

## Performance Issues

### Slow Build Times
**Problem**: Development server or build is slow
**Solutions**:
1. **Optimize Next.js Configuration**:
   ```javascript
   // next.config.mjs
   const nextConfig = {
     experimental: {
       optimizePackageImports: ['@/components', '@/lib'],
     },
     webpack: (config) => {
       config.resolve.alias = {
         ...config.resolve.alias,
         '@': path.resolve(__dirname, 'src'),
       };
       return config;
     },
   };
   ```

2. **Use Dynamic Imports**:
   ```typescript
   // Lazy load heavy components
   const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
     loading: () => <div>Loading...</div>,
   });
   ```

3. **Optimize Bundle Size**:
   ```bash
   # Analyze bundle size
   npm run build-stats
   
   # Check for duplicate dependencies
   npm ls --depth=0
   ```

### Memory Issues
**Problem**: High memory usage or memory leaks
**Solutions**:
1. **Check for Memory Leaks**:
   ```typescript
   // Clean up event listeners and subscriptions
   useEffect(() => {
     const subscription = someService.subscribe();
     return () => subscription.unsubscribe();
   }, []);
   ```

2. **Optimize Re-renders**:
   ```typescript
   // Use React.memo for expensive components
   const ExpensiveComponent = React.memo(({ data }) => {
     // Component logic
   });
   
   // Use useMemo for expensive calculations
   const expensiveValue = useMemo(() => {
     return computeExpensiveValue(data);
   }, [data]);
   ```

## Testing Issues

### Test Failures
**Problem**: Tests are failing or not running
**Solutions**:
1. **Check Test Configuration**:
   ```javascript
   // vitest.config.mts
   import { defineConfig } from 'vitest/config';
   import react from '@vitejs/plugin-react';
   
   export default defineConfig({
     plugins: [react()],
     test: {
       environment: 'jsdom',
       setupFiles: ['./vitest-setup.ts'],
     },
   });
   ```

2. **Fix Test Setup**:
   ```typescript
   // vitest-setup.ts
   import '@testing-library/jest-dom';
   import { vi } from 'vitest';
   
   // Mock environment variables
   vi.mock('process', () => ({
     env: {
       NODE_ENV: 'test',
     },
   }));
   ```

3. **Update Test Dependencies**:
   ```bash
   # Update testing libraries
   npm update @testing-library/react @testing-library/jest-dom vitest
   ```

### E2E Test Issues
**Problem**: Playwright tests failing
**Solutions**:
1. **Check Playwright Configuration**:
   ```typescript
   // playwright.config.ts
   import { defineConfig } from '@playwright/test';
   
   export default defineConfig({
     testDir: './tests/e2e',
     use: {
       baseURL: 'http://localhost:3000',
     },
     webServer: {
       command: 'npm run dev',
       url: 'http://localhost:3000',
     },
   });
   ```

2. **Fix Test Environment**:
   ```bash
   # Install Playwright browsers
   npx playwright install
   
   # Run tests with debug mode
   npx playwright test --debug
   ```

## Deployment Issues

### Build Failures
**Problem**: Production build fails
**Solutions**:
1. **Check Environment Variables**:
   ```bash
   # Verify all required env vars are set
   echo $DATABASE_URL
   echo $NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
   echo $CLERK_SECRET_KEY
   ```

2. **Fix Build Errors**:
   ```bash
   # Check for build errors
   npm run build
   
   # Fix TypeScript errors
   npm run check-types
   ```

3. **Optimize Build**:
   ```bash
   # Analyze bundle size
   npm run build-stats
   
   # Check for unused dependencies
   npx depcheck
   ```

### Runtime Errors
**Problem**: Application crashes in production
**Solutions**:
1. **Check Error Logs**:
   ```bash
   # Check application logs
   tail -f logs/app.log
   
   # Check Sentry for errors
   # (if Sentry is configured)
   ```

2. **Verify Dependencies**:
   ```bash
   # Check for missing dependencies
   npm ls --production
   
   # Update dependencies
   npm update
   ```

3. **Check Environment Configuration**:
   ```typescript
   // Verify environment variables
   console.log('NODE_ENV:', process.env.NODE_ENV);
   console.log('DATABASE_URL:', process.env.DATABASE_URL ? 'Set' : 'Not set');
   ```

## Debugging Tools

### Development Debugging
```bash
# Enable debug mode
DEBUG=* npm run dev

# Check specific modules
DEBUG=next:* npm run dev

# Use Sentry Spotlight for local debugging
npm run dev:spotlight
```

### Database Debugging
```bash
# Open Drizzle Studio
npm run db:studio

# Check database schema
npm run db:generate

# Run database migrations
npm run db:migrate
```

### Performance Debugging
```bash
# Analyze bundle size
npm run build-stats

# Check for performance issues
npm run lighthouse

# Profile memory usage
node --inspect npm run dev
```

## Quick Fixes

### Reset Everything
```bash
# Complete reset
rm -rf node_modules package-lock.json .next
npm install
npm run build
```

### Clear Caches
```bash
# Clear Next.js cache
rm -rf .next

# Clear npm cache
npm cache clean --force

# Clear browser cache
# (Browser specific)
```

### Update Dependencies
```bash
# Update all dependencies
npm update

# Update specific packages
npm update next react react-dom

# Check for security vulnerabilities
npm audit
npm audit fix
```
